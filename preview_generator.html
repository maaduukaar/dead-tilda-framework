<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Генератор Превью v.1.2 -->
    <meta charset="UTF-8">
    <title>Генератор Превью Новостей</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        textarea {
            height: 250px; /* Увеличим высоту полей для удобства */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-8 rounded-2xl shadow-lg">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Генератор превью новостей</h1>
                <p class="text-gray-500 mt-2">Заполните поля, проверьте шаблон и получите готовый код превью.</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <form id="preview-form" class="space-y-6">
                    <!-- Левая колонка с полями ввода -->
                    <div>
                        <label for="image_url" class="block text-sm font-medium text-gray-700 mb-1">URL изображения</label>
                        <input type="url" id="image_url" required placeholder="https://..." class="block w-full px-4 py-3 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Дата</label>
                        <input type="text" id="date" required placeholder="ДД.ММ.ГГГГ" class="block w-full px-4 py-3 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="link" class="block text-sm font-medium text-gray-700 mb-1">Ссылка</label>
                        <input type="url" id="link" required placeholder="https://example.com/news/..." class="block w-full px-4 py-3 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Заголовок</label>
                        <input type="text" id="title" required class="block w-full px-4 py-3 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="text" class="block text-sm font-medium text-gray-700 mb-1">Текст</label>
                        <textarea id="text" required class="block w-full px-4 py-3 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" style="height: 120px;"></textarea>
                    </div>
                </form>

                <div class="space-y-6">
                    <!-- Правая колонка с шаблоном и результатом -->
                    <div>
                        <label for="template-container" class="block text-sm font-medium text-gray-700 mb-1">Ваш HTML-шаблон</label>
                        <textarea id="template-container" class="block w-full px-4 py-3 bg-gray-900 text-green-400 font-mono text-xs border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Вставьте сюда шаблон с плейсхолдерами..."><!-- Шаблон {{COMMENT_ID}}. Начало-->
<li
  class="js-feed-post t-feed__post t-item t-width t-feed__grid-col t-col t-col_4 t-align_left"
  data-post-uid="89nmunc9v1"
  style="cursor: pointer"
>
  <div class="t-feed__col-grid__post-wrapper">
    <div
      class="t-feed__post-imgwrapper t-feed__post-imgwrapper_beforetitle"
      style="aspect-ratio: 1.8"
    >
      <div class="t-feed__post-label-wrapper"></div>
      <!--Картинка. Обновление адреса картинки - {{IMAGE_URL}}-->
      <div
        class="t-feed__post-bgimg t-bgimg loaded"
        bgimgfield="fe_img__89nmunc9v1"
        data-original="/images/news/{{IMAGE_FILENAME}}"
        style="
          background-image: url('/images/news/{{IMAGE_FILENAME}}');
        "
        src=""
      ></div>
    </div>
    <div
      class="t-feed__col-grid__wrapper t-feed__col-grid__wrapper_align"
    >
      <div
        class="t-feed__post-parts-date-row t-feed__post-parts-date-row_beforetitle"
      >
        <!--Дата-->
        <span
          class="js-feed-post-date t-feed__post-date t-uptitle t-uptitle_xs"
          >{{PREVIEW_DATE}}</span
        >
      </div>
      <div class="t-feed__textwrapper">
        <div
          class="js-feed-post-title t-feed__post-title t-name t-name_md"
          field="fe_title__89nmunc9v1"
          data-redactor-toolbar="no"
        >
          <!--Заголовок-ссылка-->
          <a
            href="{{PREVIEW_LINK}}"
            class="t-feed__link js-feed-post-link"
            role="button"
            aria-haspopup="dialog"
            target="_blank"
          >
            {{PREVIEW_TITLE}}
          </a>
        </div>
        <!--Текст новости-->
        <div
          class="js-feed-post-descr t-feed__post-descr t-descr t-descr_xxs"
          field="fe_descr__89nmunc9v1"
          data-redactor-toolbar="no"
        >
          {{PREVIEW_TEXT}}
        </div>
      </div>
    </div>
  </div>
</li>
<!-- ---Шаблон {{COMMENT_ID}}. Конец.--></textarea>
                    </div>
                    <div>
                        <label for="result" class="block text-sm font-medium text-gray-700 mb-1">Готовый код превью</label>
                        <textarea id="result" readonly class="block w-full px-4 py-3 bg-gray-200 text-gray-600 font-mono text-xs border-gray-300 rounded-lg"></textarea>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <button id="generate-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md">
                    Сгенерировать и скопировать код
                </button>
            </div>
        </div>
    </div>
    
    <script>
        document.getElementById('generate-btn').addEventListener('click', function() {
            // 1. Сбор данных из формы
            const imageUrl = document.getElementById('image_url').value;
            const dateStr = document.getElementById('date').value;
            const linkUrl = document.getElementById('link').value;
            const titleStr = document.getElementById('title').value;
            const textStr = document.getElementById('text').value;
            let templateHTML = document.getElementById('template-container').value;

            // 2. Проверка, вставлен ли шаблон
            if (templateHTML.trim() === '') {
                alert('Пожалуйста, вставьте HTML-код вашего шаблона в соответствующее поле.');
                return;
            }
            
            // 3. Подготовка контента для замены
            const firstTwoWords = titleStr.split(' ').slice(0, 2).join(' ');
            const commentId = `${dateStr} ${firstTwoWords}`;

            let imageName = '';
            try {
                const url = new URL(imageUrl);
                imageName = url.pathname.split('/').pop();
            } catch (e) {
                console.error("Неверный URL изображения, используется fallback:", e);
                imageName = imageUrl.split('/').pop().split('?')[0];
            }
            
            // 4. Замена плейсхолдеров
            let finalHtml = templateHTML
                .replace(/{{COMMENT_ID}}/g, commentId)
                .replace(/{{IMAGE_URL}}/g, imageUrl)
                .replace(/{{IMAGE_FILENAME}}/g, imageName)
                .replace(/{{PREVIEW_DATE}}/g, dateStr)
                .replace(/{{PREVIEW_LINK}}/g, linkUrl)
                .replace(/{{PREVIEW_TITLE}}/g, titleStr)
                .replace(/{{PREVIEW_TEXT}}/g, textStr);

            // 5. Вывод результата в поле "Готовый код"
            const resultTextarea = document.getElementById('result');
            resultTextarea.value = finalHtml;
            
            // 6. Автоматическое копирование результата
            if (resultTextarea.value) {
                resultTextarea.select();
                document.execCommand('copy');
                alert('Код сгенерирован и скопирован в буфер обмена!');
            }
        });

    </script>
</body>
</html>
